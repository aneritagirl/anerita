<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ANERITA — App</title>
  <meta name="description" content="Set up and show your ANERITA emergency card. Works offline." />
  <link rel="stylesheet" href="styles/site.css" />
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png" />
</head>
<body>

<header class="site-header">
  <div class="container bar">
    <a class="brand" href="/" aria-label="Anerita Home"><span>AN</span><span class="er">ER</span><span>ITA</span><sup>™</sup></a>
    <nav class="nav-actions">
      <a class="btn btn-ghost" id="greet"></a>
      <a class="btn btn-primary" href="#" id="showCardBtn">Open Emergency</a>
    </nav>
  </div>
</header>

<main class="wide">
  <div class="container" style="max-width:940px">

    <!-- Progress -->
    <div style="display:flex; gap:8px; flex-wrap:wrap; margin-bottom:16px">
      <span class="chip" id="statusChip">Offline‑ready</span>
      <span class="chip" id="countChip">0 / 12</span>
    </div>

    <!-- Tabs -->
    <nav style="display:flex; gap:8px; flex-wrap:wrap; margin-bottom:16px">
      <button class="btn btn-ghost" data-step="1">1. Profile</button>
      <button class="btn btn-ghost" data-step="2">2. Medical</button>
      <button class="btn btn-ghost" data-step="3">3. Preferences</button>
      <button class="btn btn-primary" id="saveAll">Save</button>
    </nav>

    <!-- STEP 1: Profile -->
    <section class="card step" id="step1">
      <h2>Profile & ICE</h2>
      <div class="grid" style="--cols:2">
        <label class="field">
          <span>Full name</span>
          <input id="p_name" placeholder="Jane Doe" autocomplete="name" />
        </label>
        <label class="field">
          <span>Date of birth</span>
          <input id="p_dob" type="date" />
        </label>
        <label class="field">
          <span>Primary language</span>
          <input id="p_lang" placeholder="English" />
        </label>
        <label class="field">
          <span>ICE contact (name)</span>
          <input id="p_ice_name" placeholder="Partner / Parent" />
        </label>
        <label class="field">
          <span>ICE phone</span>
          <input id="p_ice_phone" placeholder="+44 7700 900000" />
        </label>
        <label class="field">
          <span>Notes (optional)</span>
          <input id="p_notes" placeholder="Hearing impaired / carries EpiPen" />
        </label>
      </div>
    </section>

    <!-- STEP 2: Medical -->
    <section class="card step" id="step2" hidden>
      <h2>Medical essentials</h2>
      <div class="grid" style="--cols:2">
        <label class="field">
          <span>Allergies</span>
          <textarea id="m_allergies" rows="3" placeholder="Penicillin; Peanuts"></textarea>
        </label>
        <label class="field">
          <span>Conditions</span>
          <textarea id="m_conditions" rows="3" placeholder="Diabetes type 1; Epilepsy"></textarea>
        </label>
        <label class="field">
          <span>Medications</span>
          <textarea id="m_meds" rows="3" placeholder="Warfarin 5mg daily; Insulin"></textarea>
        </label>
        <label class="field">
          <span>Other info</span>
          <textarea id="m_other" rows="3" placeholder="Pacemaker; Pregnancy 20w"></textarea>
        </label>
      </div>
    </section>

    <!-- STEP 3: Preferences -->
    <section class="card step" id="step3" hidden>
      <h2>Preferences</h2>
      <div class="grid" style="--cols:2">
        <label class="field">
          <span>Triage color</span>
          <select id="pref_triage">
            <option value="">Select</option>
            <option>Green</option>
            <option>Yellow</option>
            <option>Red</option>
            <option>Black</option>
          </select>
        </label>
        <label class="field">
          <span>Card language</span>
          <input id="pref_card_lang" placeholder="English / Español / …" />
        </label>
        <label class="field">
          <span>Voice playback</span>
          <select id="pref_voice">
            <option value="">Off</option>
            <option value="on">On</option>
          </select>
        </label>
        <div class="field">
          <button class="btn btn-ghost" id="testVoice">Test voice</button>
        </div>
      </div>
      <div style="margin-top:8px">
        <button class="btn btn-primary" id="previewBtn">View Emergency Card</button>
      </div>
    </section>

    <!-- Emergency Card Preview -->
    <section class="card" id="card" hidden>
      <h2 style="margin-top:0">Emergency Card</h2>
      <p class="note">Show this screen to responders. Tap “Play” to speak the summary.</p>
      <div id="cardView" style="line-height:1.6"></div>
      <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn btn-primary" id="play">Play</button>
        <button class="btn btn-ghost" id="edit">Edit</button>
      </div>
    </section>

  </div>
</main>

<footer class="footer">
  <div class="container">
    <div class="foot-row">
      <div>© 2025 ANERITA — Emergency Response Identification Tag Aid</div>
      <nav class="foot-nav">
        <a href="index.html#features" class="btn btn-ghost">Features</a>
        <a href="index.html#how" class="btn btn-ghost">How it works</a>
        <a href="privacy.html" class="btn btn-ghost">Privacy</a>
        <a href="terms.html" class="btn btn-ghost">Terms</a>
      </nav>
    </div>
  </div>
</footer>

<script>
  // ------- tiny state layer (localStorage) -------
  const KEY = 'anerita_profile_v1';
  const $ = (id)=>document.getElementById(id);

  function load() {
    try { return JSON.parse(localStorage.getItem(KEY)) || {}; }
    catch { return {}; }
  }
  function save(data) {
    localStorage.setItem(KEY, JSON.stringify(data));
    updateCount();
  }

  // prefill greeting
  const email = localStorage.getItem('anerita_user_email');
  if (email) $('greet').textContent = email;

  // step nav
  document.querySelectorAll('[data-step]').forEach(btn=>{
    btn.addEventListener('click', ()=> showStep(+btn.dataset.step));
  });
  function showStep(n){
    document.querySelectorAll('.step').forEach(s => s.hidden = true);
    $('step'+n).hidden = false;
    window.scrollTo({top:0, behavior:'smooth'});
  }

  // Save all
  $('saveAll').addEventListener('click', ()=>{
    const data = {
      profile: {
        name: $('p_name').value.trim(),
        dob: $('p_dob').value,
        lang: $('p_lang').value.trim(),
        ice_name: $('p_ice_name').value.trim(),
        ice_phone: $('p_ice_phone').value.trim(),
        notes: $('p_notes').value.trim(),
      },
      medical: {
        allergies: $('m_allergies').value.trim(),
        conditions: $('m_conditions').value.trim(),
        meds: $('m_meds').value.trim(),
        other: $('m_other').value.trim(),
      },
      prefs: {
        triage: $('pref_triage').value,
        card_lang: $('pref_card_lang').value.trim(),
        voice: $('pref_voice').value,
      }
    };
    save(data);
    flash('Saved');
  });

  // load into fields
  (function hydrate(){
    const d = load();
    if(d.profile){
      $('p_name').value = d.profile.name || '';
      $('p_dob').value  = d.profile.dob || '';
      $('p_lang').value = d.profile.lang || '';
      $('p_ice_name').value = d.profile.ice_name || '';
      $('p_ice_phone').value = d.profile.ice_phone || '';
      $('p_notes').value = d.profile.notes || '';
    }
    if(d.medical){
      $('m_allergies').value = d.medical.allergies || '';
      $('m_conditions').value = d.medical.conditions || '';
      $('m_meds').value = d.medical.meds || '';
      $('m_other').value = d.medical.other || '';
    }
    if(d.prefs){
      $('pref_triage').value = d.prefs.triage || '';
      $('pref_card_lang').value = d.prefs.card_lang || '';
      $('pref_voice').value = d.prefs.voice || '';
    }
    updateCount();
    // if anchor is #setup, stay on step1
    if(location.hash === '#setup') showStep(1);
  })();

  function updateCount(){
    const d = load();
    const vals = [
      d?.profile?.name, d?.profile?.dob, d?.profile?.ice_phone,
      d?.medical?.allergies, d?.medical?.conditions, d?.medical?.meds
    ].filter(Boolean).length;
    $('countChip').textContent = `${vals} / 12`;
  }

  function flash(msg){
    const c = document.createElement('div');
    c.textContent = msg;
    c.style.position='fixed'; c.style.bottom='20px'; c.style.left='50%';
    c.style.transform='translateX(-50%)';
    c.style.padding='8px 14px'; c.style.borderRadius='999px';
    c.style.background='#111214'; c.style.color='#fff';
    c.style.zIndex='9999';
    document.body.appendChild(c);
    setTimeout(()=>c.remove(),1200);
  }

  // Preview & voice
  $('previewBtn').addEventListener('click', showCard);
  $('showCardBtn').addEventListener('click', showCard);
  $('edit').addEventListener('click', ()=> { $('card').hidden=true; showStep(1); });

  function showCard(){
    const d = load();
    const safe = (v)=> (v && String(v).trim()) || '—';
    $('card').hidden = false;
    $('cardView').innerHTML = `
      <div><strong>Name:</strong> ${safe(d?.profile?.name)}</div>
      <div><strong>DOB:</strong> ${safe(d?.profile?.dob)}</div>
      <div><strong>Allergies:</strong> ${safe(d?.medical?.allergies)}</div>
      <div><strong>Conditions:</strong> ${safe(d?.medical?.conditions)}</div>
      <div><strong>Meds:</strong> ${safe(d?.medical?.meds)}</div>
      <div><strong>ICE:</strong> ${safe(d?.profile?.ice_name)} — ${safe(d?.profile?.ice_phone)}</div>
      <div><strong>Triage:</strong> ${safe(d?.prefs?.triage)}</div>
      <div style="margin-top:6px"><small>Last updated: ${new Date().toLocaleString()}</small></div>
    `;
    window.scrollTo({top: $('card').offsetTop - 12, behavior:'smooth'});
  }

  $('play').addEventListener('click', ()=>{
    const d = load();
    const parts = [
      d?.profile?.name && `Patient ${d.profile.name}.`,
      d?.medical?.allergies && `Allergies: ${d.medical.allergies}.`,
      d?.medical?.conditions && `Conditions: ${d.medical.conditions}.`,
      d?.medical?.meds && `Medications: ${d.medical.meds}.`,
      d?.profile?.ice_phone && `Emergency contact ${d.profile.ice_name || ''} ${d.profile.ice_phone}.`,
      d?.prefs?.triage && `Triage ${d.prefs.triage}.`
    ].filter(Boolean).join(' ');
    const utter = new SpeechSynthesisUtterance(parts || 'No data available.');
    speechSynthesis.cancel();
    speechSynthesis.speak(utter);
  });
</script>
</body>
</html>
